{
  "resourceType": "Library",
  "id": "doping-lens",
  "meta": {
    "profile": [
      "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lens"
    ]
  },
  "type": {
    "coding": [
      {
        "code": "logical-library"
      }
    ]
  },
  "extension": [
    {
      "url": "http://hl7.eu/fhir/ig/gravitate-health/StructureDefinition/lee-version",
      "valueString": "dev"
    }
  ],
  "url": "http://hl7.eu/fhir/ig/gravitate-health/Library/588",
  "identifier": [
    {
      "system": "http://gravitate-health.lst.tfo.upm.es",
      "value": "doping-lens"
    }
  ],
  "version": "0.0.1",
  "name": "Doping lens",
  "_name": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para el doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente de aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til doping"
          }
        ]
      }
    ]
  },
  "title": "doping-lens",
  "_title": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente para aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente para aviso doping"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse til doping"
          }
        ]
      }
    ]
  },
  "status": "draft",
  "experimental": true,
  "date": "2026-02-03T11:03:54.348Z",
  "publisher": "Gravitate Health Project - UPM Team",
  "contact": [
    {
      "name": "Gravitate Health",
      "telecom": [
        {
          "system": "url",
          "value": "https://www.gravitatehealth.eu/"
        }
      ]
    }
  ],
  "description": "Lens that highlights doping-related information for professional athletes when the medication contains WADA prohibited substances",
  "_description": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Lente que resalta información relacionada con el doping para atletas profesionales cuando el medicamento contiene sustancias prohibidas por la WADA"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Lente que destaca informações relacionadas com doping para atletas profissionais quando o medicamento contém substâncias proibidas pela WADA"
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Linse der fremhæver dopingrelaterede oplysninger for professionelle atleter når medicinen indeholder WADA-forbudte stoffer"
          }
        ]
      }
    ]
  },
  "jurisdiction": [
    {
      "coding": [
        {
          "code": "EU",
          "system": "urn:iso:std:iso:3166"
        }
      ]
    }
  ],
  "purpose": "Highlight doping-related warnings in a preprocessed ePI when the patient is a professional athlete and the medication contains WADA prohibited substances.",
  "_purpose": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Resaltar advertencias relacionadas con el doping en una ePI preprocesada cuando el paciente es un atleta profesional y el medicamento contiene sustancias prohibidas por la WADA."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Destacar avisos relacionados com doping em uma ePI pré-processada quando o paciente é um atleta profissional e o medicamento contém substâncias proibidas pela WADA."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Fremhæv dopingrelaterede advarsler i en forbehandlet ePI når patienten er professionel atlet og medicinen indeholder WADA-forbudte stoffer."
          }
        ]
      }
    ]
  },
  "usage": "You can import this lens directly to your FHIR Server which suports Library Resource type.",
  "_usage": {
    "extension": [
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "es"
          },
          {
            "url": "content",
            "valueString": "Puedes importar esta lente directamente a tu servidor FHIR que soporte el tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "pt"
          },
          {
            "url": "content",
            "valueString": "Podes importar esta lente diretamente para o teu servidor FHIR que suporte o tipo de recurso Library."
          }
        ]
      },
      {
        "url": "http://hl7.org/fhir/StructureDefinition/translation",
        "extension": [
          {
            "url": "lang",
            "valueCode": "da"
          },
          {
            "url": "content",
            "valueString": "Du kan importere denne linse direkte til din FHIR-server, som understøtter ressource-typen Library."
          }
        ]
      }
    ]
  },
  "copyright": "© 2024 Gravitate Health",
  "parameter": [
    {
      "use": "in",
      "documentation": "parameter if it exists",
      "type": "CodeableConcept"
    }
  ],
  "content": [
    {
      "contentType": "application/javascript",
      "title": "Lens for doping warning",
      "data": "bGV0IHB2RGF0YSA9IHB2OwpsZXQgaHRtbERhdGEgPSBodG1sOwoKbGV0IGVwaURhdGEgPSBlcGk7CmxldCBpcHNEYXRhID0gaXBzOwpsZXQgbGFuZyA9ICIiOyAgLy8gRGVmYXVsdCBsYW5ndWFnZSwgd2lsbCBiZSBzZXQgYnkgZVBJCgpsZXQgZ2V0U3BlY2lmaWNhdGlvbiA9ICgpID0+IHsKICByZXR1cm4gIjEuMC4wIjsKfTsKCi8vVE9ETyBjaGVjayBpZiBtZWRpY2F0aW9uIGhhcyB0aGUgdGV4dCBvbiBpdCAtIGluIFBUIHRoZXJlIGlzIHRoYXQgaW5mbywgZm9yIGV4YW1wbGUgLSBjcmVhdGUgZVBJIGZvciBpdC4KLy9UT0RPIGV4cGxvcmUgaWYgY291bGQgYWRkIGFsc28gb24gdG9wIHNvbWV0aGluZyBpZiBub3QgdGhlcmUuCmxldCBhbm5vdGF0aW9uUHJvY2VzcyA9IChsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnLCBkb2N1bWVudCwgcmVzcG9uc2UpID0+IHsKICBsaXN0T2ZDYXRlZ29yaWVzLmZvckVhY2goKGNoZWNrKSA9PiB7CiAgICBpZiAocmVzcG9uc2UuaW5jbHVkZXMoY2hlY2spKSB7CiAgICAgIGxldCBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoY2hlY2spOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZWxlbWVudHNbaV0uY2xhc3NMaXN0LmFkZChlbmhhbmNlVGFnKTsKICAgICAgICBlbGVtZW50c1tpXS5jbGFzc0xpc3QuYWRkKCJkb3BpbmctbGVucyIpOwogICAgICB9CiAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpLmxlbmd0aCA+IDApIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdLnJlbW92ZSgpOwogICAgICB9CiAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpLmxlbmd0aCA+IDApIHsKICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0uaW5uZXJIVE1MOwogICAgICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIHJlc3BvbnNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygiUmVzcG9uc2U6ICIgKyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuaW5uZXJIVE1MKTsKICAgICAgICByZXNwb25zZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5pbm5lckhUTUw7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgaWYgKHJlc3BvbnNlID09IG51bGwgfHwgcmVzcG9uc2UgPT0gIiIpIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgIkFubm90YXRpb24gcHJvY2Nlc3MgZmFpbGVkOiBSZXR1cm5lZCBlbXB0eSBvciBudWxsIHJlc3BvbnNlIgogICAgKTsKICAgIC8vcmV0dXJuIGh0bWxEYXRhCiAgfSBlbHNlIHsKICAgIGNvbnNvbGUubG9nKCJSZXNwb25zZTogIiArIHJlc3BvbnNlKTsKICAgIHJldHVybiByZXNwb25zZTsKICB9Cn0KCgpsZXQgYW5ub3RhdGVIVE1Mc2VjdGlvbiA9IGFzeW5jIChsaXN0T2ZDYXRlZ29yaWVzLCBlbmhhbmNlVGFnKSA9PiB7CiAgbGV0IHJlc3BvbnNlID0gaHRtbERhdGE7CiAgbGV0IGRvY3VtZW50OwoKICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsKICAgIGxldCBqc2RvbSA9IGF3YWl0IGltcG9ydCgianNkb20iKTsKICAgIGxldCB7IEpTRE9NIH0gPSBqc2RvbTsKICAgIGxldCBkb20gPSBuZXcgSlNET00oaHRtbERhdGEpOwogICAgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50OwogICAgcmV0dXJuIGFubm90YXRpb25Qcm9jZXNzKGxpc3RPZkNhdGVnb3JpZXMsIGVuaGFuY2VUYWcsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgfSBlbHNlIHsKICAgIGRvY3VtZW50ID0gd2luZG93LmRvY3VtZW50OwogICAgcmV0dXJuIGFubm90YXRpb25Qcm9jZXNzKGxpc3RPZkNhdGVnb3JpZXMsIGVuaGFuY2VUYWcsIGRvY3VtZW50LCByZXNwb25zZSk7CiAgfQp9OwoKCgpsZXQgZW5oYW5jZSA9IGFzeW5jICgpID0+IHsKICBpZiAoIWlwc0RhdGEgfHwgIWlwc0RhdGEuZW50cnkgfHwgaXBzRGF0YS5lbnRyeS5sZW5ndGggPT09IDApIHsKICAgIHRocm93IG5ldyBFcnJvcigiSVBTIGlzIGVtcHR5IG9yIGludmFsaWQuIik7CiAgfQogIGlmICghZXBpRGF0YSB8fCAhZXBpRGF0YS5lbnRyeSB8fCBlcGlEYXRhLmVudHJ5Lmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJlUEkgaXMgZW1wdHkgb3IgaW52YWxpZC4iKTsKICB9CgogIC8vIDEuIENoZWNrIENvbXBvc2l0aW9uLmxhbmd1YWdlCiAgZXBpRGF0YS5lbnRyeT8uZm9yRWFjaCgoZW50cnkpID0+IHsKICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgaWYgKHJlcz8ucmVzb3VyY2VUeXBlID09PSAiQ29tcG9zaXRpb24iICYmIHJlcy5sYW5ndWFnZSkgewogICAgICBsYW5nID0gcmVzLmxhbmd1YWdlOwogICAgICBjb25zb2xlLmxvZygi8J+MjSBEZXRlY3RlZCBmcm9tIENvbXBvc2l0aW9uLmxhbmd1YWdlOiIsIGxhbmcpOwogICAgfQogIH0pOwoKICAvLyAyLiBJZiBub3QgZm91bmQsIGNoZWNrIEJ1bmRsZS5sYW5ndWFnZQogIGlmICghbGFuZyAmJiBlcGlEYXRhLmxhbmd1YWdlKSB7CiAgICBsYW5nID0gZXBpRGF0YS5sYW5ndWFnZTsKICAgIGNvbnNvbGUubG9nKCLwn4yNIERldGVjdGVkIGZyb20gQnVuZGxlLmxhbmd1YWdlOiIsIGxhbmcpOwogIH0KCiAgLy8gMy4gRmFsbGJhY2sKICBpZiAoIWxhbmcpIHsKICAgIGNvbnNvbGUud2Fybigi4pqg77iPIE5vIGxhbmd1YWdlIGRldGVjdGVkIGluIENvbXBvc2l0aW9uIG9yIEJ1bmRsZS4iKTsKICAgIGxhbmcgPSAiZW4iOwogIH0KCiAgbGV0IGVuaGFuY2VUYWcgPSAiaGlnaGxpZ2h0IjsKICAvLyBNYXRjaCBsaXN0cwogIGNvbnN0IFdBREFfQlVORExFX0lERU5USUZJRVJfTElTVCA9IFsiZXBpYnVuZGxlLTEyMyIsICJlcGlidW5kbGUtYWJjIl07CiAgY29uc3QgV0FEQV9MSVNUID0gWwogICAgIjExMTUwMDkiLCAvLyBFeGFtcGxlOiBUZXN0b3N0ZXJvbmUKICAgICIxMjM0NTY3IiwgLy8gRXhhbXBsZTogRXJ5dGhyb3BvaWV0aW4gKEVQTykKICAgICIyMDQ0MzIiLCAgLy8gRXhhbXBsZTogQ2xlbmJ1dGVyb2wKICAgICIzNjAxNDciICAgLy8gRXhhbXBsZTogT3hhbmRyb2xvbmUKICBdOwoKICBsZXQgbGlzdE9mQ2F0ZWdvcmllc1RvU2VhcmNoID0gWyJncmF2LTIiXTsgLy93aGF0IHRvIGxvb2sgaW4gZXh0ZW5zaW9uIHRvIGZpbmQgY2xhc3MKICAvLyBzaG91bGQgd2UgYWRkIHRoZSB3YXJuaW5nIGV2ZW4gd2l0aG91dCB0aGUgY2xhc3M/PyAtIHNlZSBxdWVzdGlvbm5haXJlIGxlbnMKCiAgbGV0IGlzUHJvZmVzc2lvbmFsQXRobGV0ZSA9IGZhbHNlOwogIGxldCBpc1Byb2hpYml0ZWREcnVnID0gZmFsc2U7CgoKICBmb3IgKGNvbnN0IGVudHJ5IG9mIGlwc0RhdGEuZW50cnkpIHsKICAgIGNvbnN0IHJlcyA9IGVudHJ5LnJlc291cmNlOwogICAgaWYgKCFyZXMpIGNvbnRpbnVlOwoKICAgIC8vIDEuIENoZWNrIFBhdGllbnQgZXh0ZW5zaW9uCiAgICBpZiAocmVzLnJlc291cmNlVHlwZSA9PT0gIlBhdGllbnQiICYmIEFycmF5LmlzQXJyYXkocmVzLmV4dGVuc2lvbikpIHsKICAgICAgZm9yIChjb25zdCBleHQgb2YgcmVzLmV4dGVuc2lvbikgewogICAgICAgIC8vY29uc29sZS5sb2coZXh0LnZhbHVlQ29kZWFibGVDb25jZXB0LmNvZGluZykKICAgICAgICBpZiAoCiAgICAgICAgICBleHQudXJsID09PSAiaHR0cDovL2hsNy5vcmcvZmhpci9TdHJ1Y3R1cmVEZWZpbml0aW9uL2luZGl2aWR1YWwtb2NjdXBhdGlvbiIgJiYKICAgICAgICAgIGV4dC52YWx1ZUNvZGVhYmxlQ29uY2VwdC5jb2RpbmdbMF0uY29kZSA9PSAiMzQyMSIgLy9BdGhsZXRlcyBhbmQgc3BvcnRzIHBsYXllcnMiCiAgICAgICAgICAmJiBleHQudmFsdWVDb2RlYWJsZUNvbmNlcHQuY29kaW5nWzBdLnN5c3RlbSA9PSAiaHR0cDovL3d3dy5pbG8ub3JnL3B1YmxpYy9lbmdsaXNoL2J1cmVhdS9zdGF0L2lzY28iCiAgICAgICAgKSB7CiAgICAgICAgICBpc1Byb2Zlc3Npb25hbEF0aGxldGUgPSB0cnVlOwogICAgICAgICAgY29uc29sZS5sb2coIvCfj4PigI3imYLvuI8gQXRobGV0ZSBzdGF0dXM6IHByb2Zlc3Npb25hbCIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIC8vc2VhcmNoIElQUyB0byBsb29rIGl0IHVwIGFzIHdlbGwKICBpcHMuZW50cnkuZm9yRWFjaCgoZW50cnkpID0+IHsKICAgIGNvbnN0IHJlc291cmNlID0gZW50cnkucmVzb3VyY2U7CgogICAgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIk9ic2VydmF0aW9uIikgewogICAgICAvLyBDaGVjayBpZiBjYXRlZ29yeSBjb250YWlucyB0aGUgc29jaWFsLWhpc3RvcnkgY29kZQogICAgICBjb25zdCBoYXNTb2NpYWxIaXN0b3J5Q2F0ZWdvcnkgPSByZXNvdXJjZS5jYXRlZ29yeT8uc29tZShjYXQgPT4KICAgICAgICBjYXQuY29kaW5nPy5zb21lKGNvZGluZyA9PgogICAgICAgICAgY29kaW5nLnN5c3RlbSA9PT0gImh0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vb2JzZXJ2YXRpb24tY2F0ZWdvcnkiICYmCiAgICAgICAgICBjb2RpbmcuY29kZSA9PT0gInNvY2lhbC1oaXN0b3J5IgogICAgICAgICkKICAgICAgKTsKCiAgICAgIC8vIENoZWNrIGlmIGNvZGUgaXMgMTEzNDEtNSAoSGlzdG9yeSBvZiBPY2N1cGF0aW9uKQogICAgICBjb25zdCBoYXNPY2N1cGF0aW9uQ29kZSA9IHJlc291cmNlLmNvZGU/LmNvZGluZz8uc29tZShjb2RpbmcgPT4KICAgICAgICBjb2Rpbmcuc3lzdGVtID09PSAiaHR0cDovL2xvaW5jLm9yZyIgJiYKICAgICAgICBjb2RpbmcuY29kZSA9PT0gIjExMzQxLTUiCiAgICAgICk7CgogICAgICAvLyBDaGVjayBpZiB2YWx1ZUNvZGVhYmxlQ29uY2VwdCBpbmRpY2F0ZXMgYXRobGV0ZQogICAgICBjb25zdCBoYXNBdGhsZXRlVmFsdWUgPSByZXNvdXJjZS52YWx1ZUNvZGVhYmxlQ29uY2VwdD8uY29kaW5nPy5zb21lKGNvZGluZyA9PgogICAgICAgIGNvZGluZy5zeXN0ZW0gPT09ICJodHRwOi8vd3d3Lmlsby5vcmcvcHVibGljL2VuZ2xpc2gvYnVyZWF1L3N0YXQvaXNjbyIgJiYKICAgICAgICBjb2RpbmcuY29kZSA9PT0gIjM0MjEiCiAgICAgICk7CgogICAgICBpZiAoaGFzU29jaWFsSGlzdG9yeUNhdGVnb3J5ICYmIGhhc09jY3VwYXRpb25Db2RlICYmIGhhc0F0aGxldGVWYWx1ZSkgewogICAgICAgIGlzUHJvZmVzc2lvbmFsQXRobGV0ZSA9IHRydWU7CiAgICAgICAgY29uc29sZS5sb2coIkF0aGxldGUgc3RhdHVzIGRldGVjdGVkIGZyb20gT2JzZXJ2YXRpb24gZnJvbSBwZXJzb25hIHZlY3RvcjoiLCByZXNvdXJjZS5pZCk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgLy8gc2VhcmNoIHBlcnNvbmEgdmVjdG9yIHRvIGxvb2sgaXQgdXAgYXMgd2VsbAogIGNvbnN0IHB2RW50cmllcyA9IEFycmF5LmlzQXJyYXkocHY/LmVudHJ5KSA/IHB2LmVudHJ5IDogW107CiAgcHZFbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICBjb25zdCByZXNvdXJjZSA9IGVudHJ5LnJlc291cmNlOwoKICAgIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJPYnNlcnZhdGlvbiIpIHsKICAgICAgLy8gQ2hlY2sgaWYgY2F0ZWdvcnkgY29udGFpbnMgdGhlIHNvY2lhbC1oaXN0b3J5IGNvZGUKICAgICAgY29uc3QgaGFzU29jaWFsSGlzdG9yeUNhdGVnb3J5ID0gcmVzb3VyY2UuY2F0ZWdvcnk/LnNvbWUoY2F0ID0+CiAgICAgICAgY2F0LmNvZGluZz8uc29tZShjb2RpbmcgPT4KICAgICAgICAgIGNvZGluZy5zeXN0ZW0gPT09ICJodHRwOi8vdGVybWlub2xvZ3kuaGw3Lm9yZy9Db2RlU3lzdGVtL29ic2VydmF0aW9uLWNhdGVnb3J5IiAmJgogICAgICAgICAgY29kaW5nLmNvZGUgPT09ICJzb2NpYWwtaGlzdG9yeSIKICAgICAgICApCiAgICAgICk7CgogICAgICAvLyBDaGVjayBpZiBjb2RlIGlzIDExMzQxLTUgKEhpc3Rvcnkgb2YgT2NjdXBhdGlvbikKICAgICAgY29uc3QgaGFzT2NjdXBhdGlvbkNvZGUgPSByZXNvdXJjZS5jb2RlPy5jb2Rpbmc/LnNvbWUoY29kaW5nID0+CiAgICAgICAgY29kaW5nLnN5c3RlbSA9PT0gImh0dHA6Ly9sb2luYy5vcmciICYmCiAgICAgICAgY29kaW5nLmNvZGUgPT09ICIxMTM0MS01IgogICAgICApOwoKICAgICAgLy8gQ2hlY2sgaWYgdmFsdWVDb2RlYWJsZUNvbmNlcHQgaW5kaWNhdGVzIGF0aGxldGUKICAgICAgY29uc3QgaGFzQXRobGV0ZVZhbHVlID0gcmVzb3VyY2UudmFsdWVDb2RlYWJsZUNvbmNlcHQ/LmNvZGluZz8uc29tZShjb2RpbmcgPT4KICAgICAgICBjb2Rpbmcuc3lzdGVtID09PSAiaHR0cDovL3d3dy5pbG8ub3JnL3B1YmxpYy9lbmdsaXNoL2J1cmVhdS9zdGF0L2lzY28iICYmCiAgICAgICAgY29kaW5nLmNvZGUgPT09ICIzNDIxIgogICAgICApOwoKICAgICAgaWYgKGhhc1NvY2lhbEhpc3RvcnlDYXRlZ29yeSAmJiBoYXNPY2N1cGF0aW9uQ29kZSAmJiBoYXNBdGhsZXRlVmFsdWUpIHsKICAgICAgICBpc1Byb2Zlc3Npb25hbEF0aGxldGUgPSB0cnVlOwogICAgICAgIGNvbnNvbGUubG9nKCJBdGhsZXRlIHN0YXR1cyBkZXRlY3RlZCBmcm9tIE9ic2VydmF0aW9uIGZyb20gcGVyc29uYSB2ZWN0b3I6IiwgcmVzb3VyY2UuaWQpOwogICAgICB9CiAgICB9CiAgfSk7CgoKICAvLyAyLiBDaGVjayBtZWRpY2F0aW9ucyBmb3IgZG9waW5nIHN1YnN0YW5jZXMKICAvLyBDaGVjayBidW5kbGUuaWRlbnRpZmllci52YWx1ZQogIGlmICgKICAgIGVwaURhdGEuaWRlbnRpZmllciAmJgogICAgV0FEQV9CVU5ETEVfSURFTlRJRklFUl9MSVNULmluY2x1ZGVzKGVwaURhdGEuaWRlbnRpZmllci52YWx1ZSkKICApIHsKICAgIGNvbnNvbGUubG9nKCLwn5SXIE1hdGNoZWQgZVBJIERvcGluZyBCdW5kbGUuaWRlbnRpZmllcjoiLCBlcGlEYXRhLmlkZW50aWZpZXIudmFsdWUpOwogICAgaXNQcm9oaWJpdGVkRHJ1ZyA9IHRydWU7CiAgfQoKICAvLyBDaGVjayBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyLnZhbHVlCiAgZXBpRGF0YS5lbnRyeS5mb3JFYWNoKChlbnRyeSkgPT4gewogICAgY29uc3QgcmVzID0gZW50cnkucmVzb3VyY2U7CiAgICBpZiAocmVzPy5yZXNvdXJjZVR5cGUgPT09ICJNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbiIpIHsKICAgICAgY29uc3QgaWRzID0gcmVzLmlkZW50aWZpZXIgfHwgW107CiAgICAgIGlkcy5mb3JFYWNoKChpZCkgPT4gewogICAgICAgIGlmIChXQURBX0xJU1QuaW5jbHVkZXMoaWQudmFsdWUpKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi8J+SiiBNYXRjaGVkIERvcGluZyBNZWRpY2luYWxQcm9kdWN0RGVmaW5pdGlvbi5pZGVudGlmaWVyOiIsIGlkLnZhbHVlKTsKICAgICAgICAgIGlzUHJvaGliaXRlZERydWcgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CgoKICAvLyBlUEkgdHJhc2xhdGlvbiBmcm9tIHRlcm1pbm9sb2d5IGNvZGVzIHRvIHRoZWlyIGh1bWFuIHJlZGFibGUgdHJhbnNsYXRpb25zIGluIHRoZSBzZWN0aW9ucwogIGxldCBjb21wb3NpdGlvbnMgPSAwOwogIGxldCBjYXRlZ29yaWVzID0gW107CiAgZXBpLmVudHJ5LmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICBpZiAoZW50cnkucmVzb3VyY2UucmVzb3VyY2VUeXBlID09ICJDb21wb3NpdGlvbiIpIHsKICAgICAgY29tcG9zaXRpb25zKys7CiAgICAgIC8vSXRlcmF0ZWQgdGhyb3VnaCB0aGUgQ29uZGl0aW9uIGVsZW1lbnQgc2VhcmNoaW5nIGZvciBjb25kaXRpb25zCiAgICAgIGVudHJ5LnJlc291cmNlLmV4dGVuc2lvbi5mb3JFYWNoKChlbGVtZW50KSA9PiB7CgogICAgICAgIC8vIENoZWNrIGlmIHRoZSBwb3NpdGlvbiBvZiB0aGUgZXh0ZW5zaW9uWzFdIGlzIGNvcnJlY3QKICAgICAgICBpZiAoZWxlbWVudC5leHRlbnNpb25bMV0udXJsID09ICJjb25jZXB0IikgewogICAgICAgICAgLy8gU2VhcmNoIHRocm91Z2ggdGhlIGRpZmZlcmVudCB0ZXJtaW5vbG9naWVzIHRoYXQgbWF5IGJlIGF2YWlibGUgdG8gY2hlY2sgaW4gdGhlIGNvbmRpdGlvbgogICAgICAgICAgaWYgKGVsZW1lbnQuZXh0ZW5zaW9uWzFdLnZhbHVlQ29kZWFibGVSZWZlcmVuY2UuY29uY2VwdCAhPSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgZWxlbWVudC5leHRlbnNpb25bMV0udmFsdWVDb2RlYWJsZVJlZmVyZW5jZS5jb25jZXB0LmNvZGluZy5mb3JFYWNoKAogICAgICAgICAgICAgIChjb2RpbmcpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJFeHRlbnNpb246ICIgKyBlbGVtZW50LmV4dGVuc2lvblswXS52YWx1ZVN0cmluZyArICI6IiArIGNvZGluZy5jb2RlKQogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvZGUgaXMgaW4gdGhlIGxpc3Qgb2YgY2F0ZWdvcmllcyB0byBzZWFyY2gKICAgICAgICAgICAgICAgIGlmIChsaXN0T2ZDYXRlZ29yaWVzVG9TZWFyY2guaW5jbHVkZXMoY29kaW5nLmNvZGUpKSB7CiAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjYXRlZ29yeSBpcyBhbHJlYWR5IGluIHRoZSBsaXN0IG9mIGNhdGVnb3JpZXMKICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllcy5wdXNoKGVsZW1lbnQuZXh0ZW5zaW9uWzBdLnZhbHVlU3RyaW5nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9KTsKCgogIGlmIChjb21wb3NpdGlvbnMgPT0gMCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgZVBJOiBubyBjYXRlZ29yeSAiQ29tcG9zaXRpb24iIGZvdW5kJyk7CiAgfQoKICBpZiAoY2F0ZWdvcmllcy5sZW5ndGggPT0gMCkgewogICAgLy8gdGhyb3cgbmV3IEVycm9yKCJObyBjYXRlZ29yaWVzIGZvdW5kIiwgY2F0ZWdvcmllcyk7CiAgICByZXR1cm4gaHRtbERhdGE7CiAgfQogIGlmIChpc1Byb2Zlc3Npb25hbEF0aGxldGUgJiYgaXNQcm9oaWJpdGVkRHJ1ZykgewogICAgcmV0dXJuIGF3YWl0IGFubm90YXRlSFRNTHNlY3Rpb24oY2F0ZWdvcmllcywgZW5oYW5jZVRhZyk7CiAgfQogIGVsc2UgewoKICAgIGNvbnNvbGUud2FybigiTm8gZG9waW5nIHJpc2sgY29uZGl0aW9uIG1ldC4iKTsKICAgIHJldHVybiBodG1sRGF0YTsKICB9Cgp9OwoKCmZ1bmN0aW9uIGdldFJlcG9ydChsYW5nID0gImVuIikgewogIGNvbnNvbGUubG9nKCJHZW5lcmF0aW5nIHJlcG9ydCBpbiBsYW5ndWFnZToiLCBsYW5nKTsKICByZXR1cm4geyBtZXNzYWdlOiBnZXRFeHBsYW5hdGlvbihsYW5nKSwgc3RhdHVzOiAiIiB9OwoKCn0KCi8vIC0tLSBHZXQgdXNlci1mYWNpbmcgcmVwb3J0IHNlbnRlbmNlIGluIHRoZSBzZWxlY3RlZCBsYW5ndWFnZSAtLS0KZnVuY3Rpb24gZ2V0RXhwbGFuYXRpb24obGFuZyA9ICJlbiIpIHsKICBjb25zb2xlLmxvZygiR2VuZXJhdGluZyBleHBsYW5hdGlvbiBpbiBsYW5ndWFnZToiLCBsYW5nKTsKICByZXR1cm4gIiI7Cn0KCi8vIC0tLSBFeHBvcnRlZCBBUEkgLS0tCnJldHVybiB7CiAgZW5oYW5jZTogZW5oYW5jZSwKICBnZXRTcGVjaWZpY2F0aW9uOiBnZXRTcGVjaWZpY2F0aW9uLAogIGV4cGxhbmF0aW9uOiAobGFuZ3VhZ2UpID0+IGdldEV4cGxhbmF0aW9uKGxhbmd1YWdlIHx8IGxhbmcgfHwgImVuIiksCiAgcmVwb3J0OiAobGFuZ3VhZ2UpID0+IGdldFJlcG9ydChsYW5ndWFnZSB8fCBsYW5nIHx8ICJlbiIpLAp9Owo=",
      "_title": {
        "extension": [
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "es"
              },
              {
                "url": "content",
                "valueString": "Lente para aviso de doping"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "pt"
              },
              {
                "url": "content",
                "valueString": "Lente para aviso de doping"
              }
            ]
          },
          {
            "url": "http://hl7.org/fhir/StructureDefinition/translation",
            "extension": [
              {
                "url": "lang",
                "valueCode": "da"
              },
              {
                "url": "content",
                "valueString": "Linse til dopingadvarsel"
              }
            ]
          }
        ]
      }
    }
  ]
}